<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reset.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <title>–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }






        .contest-info {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .contest-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .contest-text {
            font-weight: 600;
            font-size: 16px;
        }

        .contest-status {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }


       

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }



       







        













        .prize-chance {
            background: #007BFF;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .draw-info {
            text-align: center;
            color: #6C757D;
            margin-bottom: 20px;
            font-size: 14px;
        }

        






        







        

        .tickets-fill {
            height: 100%;
            background: linear-gradient(90deg, #8B5CF6 0%, #A855F7 100%);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }

        .add-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #8B5CF6;
            color: white;
            border: none;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(139, 92, 246, 0.5);
        }

        .add-button:active {
            transform: scale(0.95);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            transform: scale(0.7) translateY(50px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            color: white;
            font-size: 40px;
        }


        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 16px;
        }

        .modal-text {
            font-size: 16px;
            color: #6C757D;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
        }

        .modal-button {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-button.primary {
            background: #007BFF;
            color: white;
        }

        .modal-button.primary:hover {
            background: #0056B3;
            transform: translateY(-1px);
        }

        .modal-button.secondary {
            background: #F8F9FA;
            color: #495057;
            border: 1px solid #E9ECEF;
        }

        .modal-button.secondary:hover {
            background: #E9ECEF;
            transform: translateY(-1px);
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .loading .purchase-button {
            position: relative;
            overflow: hidden;
        }

        .loading .purchase-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }

        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }


    </style>
</head>
<body class="bg2">
    <div class="header">
        <button class="header_bl" onclick="goBack()"><p>–ù–∞–∑–∞–¥</p></button>
        
        <h1>–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞</h1>
    </div>
    
    <div class="main-content">
        <!-- –ö–æ–Ω–∫—É—Ä—Å –∫–≤–∞—Ä—Ç–∏—Ä—ã (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è big —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π) -->
        <div class="apartment-contest" id="apartmentContest" style="display: none;">
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p class="progress-text" id="progressText">0 –∏–∑ 5</p>
            </div>


            <div class="contest-info">
                <img src="{{ url_for('static', filename='img/draws/big_prize1.png') }}" alt="House Icon" class="contest-icon">
                <p class="contest-text">–í—ã–∏–≥—Ä–∞–π –∫–≤–∞—Ä—Ç–∏—Ä—É</p>
                <div class="contest-status" id="contestStatus">–£—á–∞—Å—Ç–≤—É—é</div> <!-- –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç -->
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–∏–ª–µ—Ç–æ–≤ -->
        <div class="ticket-container">
            <div class="ticket" id="currentTicket">
                <div class="ticket-header">
                    
                    <h3 class="ticket-title white1" id="ticketTitle">–ë–∏–ª–µ—Ç #1</h3>
                    
                    <button class="close-button" onclick="deleteCurrentTicket()">√ó</button>
                </div>

                
                

                <div class="numbers-section">
                    <div class="section-header">
                        <h3 class="section-title white1">–í—ã–±–µ—Ä–∏—Ç–µ —á–∏—Å–ª–∞</h3>
                        <button class="lucky-button" onclick="generateLuckyNumbers()">–ú–Ω–µ –ø–æ–≤–µ–∑–µ—Ç</button>
                    </div>

                    <div class="numbers-grid">
                        <div class="gradient-1"></div>
                        <div class="gradient-2"></div>
                        <div class="number-slider" id="numberSlider">
                            
                            <!-- –°–ª–∞–π–¥–µ—Ä—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>

                
            </div>
        </div>

        <div class="ticket-bottom">
            <button class="nav-button nav-left" id="navLeft" onclick="previousTicket()">‚Äπ</button>
                <p class="ticket-counter" id="ticketCounter">1 –∏–∑ 1</p>
            <button class="nav-button nav-right" id="navRight" onclick="nextTicket()">‚Ä∫</button>
        </div>

        <span class="button-wrapper">
            <button class="add-ticket-button" onclick="addTicket()">–î–æ–±–∞–≤–∏—Ç—å –±–∏–ª–µ—Ç</button>
        </span>

        <!-- –°–µ–∫—Ü–∏—è –ø—Ä–∏–∑–æ–≤ -->
        <div class="draws-section">
            <h2 class="black1">–ß—Ç–æ –º–æ–∂–Ω–æ –≤—ã–∏–≥—Ä–∞—Ç—å</h2>
            <div id="prizesList">
                <!-- –ü—Ä–∏–∑—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–æ–∑—ã–≥—Ä—ã—à–µ -->
        <div class="draw-info" id="drawInfo">
            –†–æ–∑—ã–≥—Ä—ã—à –ø—Ä–æ–≤–µ–¥–µ–º 31 –∞–≤–≥—É—Å—Ç–∞ 14:00<br>
            –ü—Ä—è–º–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è –±—É–¥–µ—Ç –≤ –≥—Ä—É–ø–ø–µ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ Ozon
        </div>

        

        <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏ -->
        <div class="purchase-section" id="purchaseSection">
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∏–ª–µ—Ç–æ–≤ -->
            <div class="tickets-progress">
                <p class="tickets-info" id="ticketsInfo">–ï—â–µ 9 –±–∏–ª–µ—Ç–æ–≤ –∏ 1 –±–∏–ª–µ—Ç –ø–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ</p>
                <div class="tickets-bar">
                    <div class="tickets-fill" id="ticketsFill"></div>
                </div>
            </div>

            <button class="btn-yellow" onclick="purchaseTickets()">
                <span id="purchaseText">–ö—É–ø–∏—Ç—å 1 –±–∏–ª–µ—Ç</span>
                <div class="draw-cost">
                    <p id="totalPrice">100</p>
                    <img src="../static/img/icons/coin.png">
                </div>
            </button>
        </div>
    </div>


    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å–ø–µ—Ö–∞ -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="success-icon">‚úì</div>
            <div class="modal-title">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</div>
            <div class="modal-text" id="modalText">
                –í—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª–∏ 2 –±–∏–ª–µ—Ç–∞<br>
                –Ω–∞ —Å—É–º–º—É 200 ü™ô
            </div>
            <div class="modal-buttons">
                <button class="modal-button secondary" onclick="goToTickets()">–ú–æ–∏ –±–∏–ª–µ—Ç—ã</button>
                <button class="modal-button primary" onclick="goToMain()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
            </div>
        </div>
    </div>

        <script>
   // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞ –æ—Ç Flask
   window.currentDrawData = {{ draw | tojson | safe }};
   
   // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
   let currentTicketIndex = 0;
   let tickets = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö –±–∏–ª–µ—Ç–æ–≤
   let selectedNumbers = [];
   let apartmentTicketsCount = 0;
   let isAnimating = false;

   // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   document.addEventListener('DOMContentLoaded', function() {
       initializeInterface();
   });

   function initializeInterface() {
       // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç Flask –≤–º–µ—Å—Ç–æ mockDrawData
       if (!window.currentDrawData) {
           console.error('–î–∞–Ω–Ω—ã–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã');
           return;
       }
       
       // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—ã–π –±–∏–ª–µ—Ç
       tickets = [{
           id: 1,
           numbers: []
       }];
       currentTicketIndex = 0;
       
       // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–∞
       if (window.currentDrawData.category === 'big') {
           document.getElementById('apartmentContest').style.display = 'block';
           updateApartmentProgress();
       }

       // –°–æ–∑–¥–∞–µ–º —Å–ª–∞–π–¥–µ—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —á–∏—Å–µ–ª
       createNumberSliders();
       
       // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —á–∏—Å–ª–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
       generateLuckyNumbers();
       
       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–∑—ã
       displayPrizes();
       
       // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
       updateInterface();
   }

   function createNumberSliders() {
       const container = document.getElementById('numberSlider');
       container.innerHTML = '';
       
       const numbersCount = window.currentDrawData.numbers_count;
       selectedNumbers = new Array(numbersCount).fill(0);
       
       for (let i = 0; i < numbersCount; i++) {
           const column = document.createElement('div');
           column.className = 'number-column';
           
           const picker = document.createElement('div');
           picker.className = 'number-picker';
           picker.dataset.index = i;
           
           const numberList = document.createElement('div');
           numberList.className = 'number-list';
           
           // –°–æ–∑–¥–∞–µ–º —á–∏—Å–ª–∞ –æ—Ç 0 –¥–æ 9 —Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
           for (let j = 0; j < 30; j++) {
               const numberItem = document.createElement('p');
               numberItem.className = 'number-item';
               numberItem.textContent = j % 10;
               numberItem.dataset.value = j % 10;
               numberList.appendChild(numberItem);
           }
           
           const overlay = document.createElement('div');
           overlay.className = 'picker-overlay';
           
           picker.appendChild(numberList);
           picker.appendChild(overlay);
           column.appendChild(picker);
           container.appendChild(column);
           
           // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è touch/mouse
           setupSliderEvents(picker, i);
       }
   }

   function setupSliderEvents(picker, index) {
       let startY = 0;
       let currentY = 0;
       let isDragging = false;
       let currentOffset = -200; // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (5-–π —ç–ª–µ–º–µ–Ω—Ç = —á–∏—Å–ª–æ 5)
       
       const numberList = picker.querySelector('.number-list');
       
       function updatePosition(offset) {
           numberList.style.transform = `translateY(${offset}px)`;
           
           // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
           const activeIndex = Math.round(-offset / 40);
           const items = numberList.querySelectorAll('.number-item');
           
           items.forEach((item, i) => {
               item.classList.toggle('active', i === activeIndex);
           });
           
           // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ
           if (items[activeIndex]) {
               selectedNumbers[index] = parseInt(items[activeIndex].dataset.value);
               // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ç–µ–∫—É—â–∏–π –±–∏–ª–µ—Ç
               if (tickets[currentTicketIndex]) {
                   tickets[currentTicketIndex].numbers[index] = selectedNumbers[index];
               }
           }
       }
       
       // Touch events
       picker.addEventListener('touchstart', function(e) {
           startY = e.touches[0].clientY;
           isDragging = true;
           numberList.style.transition = 'none';
       });
       
       picker.addEventListener('touchmove', function(e) {
           if (!isDragging) return;
           e.preventDefault();
           
           const deltaY = e.touches[0].clientY - startY;
           currentY = currentOffset + deltaY;
           
           // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
           const maxOffset = 0;
           const minOffset = -(29 * 40);
           currentY = Math.max(minOffset, Math.min(maxOffset, currentY));
           
           updatePosition(currentY);
       });
       
       picker.addEventListener('touchend', function(e) {
           if (!isDragging) return;
           isDragging = false;
           
           // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ –±–ª–∏–∂–∞–π—à–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
           const snapOffset = Math.round(currentY / 40) * 40;
           currentOffset = snapOffset;
           
           numberList.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
           updatePosition(currentOffset);
       });
       
       // Mouse events (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞)
       picker.addEventListener('mousedown', function(e) {
           startY = e.clientY;
           isDragging = true;
           numberList.style.transition = 'none';
           e.preventDefault();
       });
       
       document.addEventListener('mousemove', function(e) {
           if (!isDragging) return;
           
           const deltaY = e.clientY - startY;
           currentY = currentOffset + deltaY;
           
           // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
           const maxOffset = 0;
           const minOffset = -(29 * 40);
           currentY = Math.max(minOffset, Math.min(maxOffset, currentY));
           
           updatePosition(currentY);
       });
       
       document.addEventListener('mouseup', function(e) {
           if (!isDragging) return;
           isDragging = false;
           
           // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ –±–ª–∏–∂–∞–π—à–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
           const snapOffset = Math.round(currentY / 40) * 40;
           currentOffset = snapOffset;
           
           numberList.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
           updatePosition(currentOffset);
       });
       
       // Wheel events –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏
       picker.addEventListener('wheel', function(e) {
           e.preventDefault();
           
           const delta = e.deltaY > 0 ? -40 : 40;
           const newOffset = currentOffset + delta;
           
           const maxOffset = 0;
           const minOffset = -(29 * 40);
           currentOffset = Math.max(minOffset, Math.min(maxOffset, newOffset));
           
           numberList.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
           updatePosition(currentOffset);
       });
       
       // –ö–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞
       picker.addEventListener('click', function(e) {
           if (isDragging) return;
           
           const item = e.target.closest('.number-item');
           if (item) {
               const items = Array.from(numberList.querySelectorAll('.number-item'));
               const clickedIndex = items.indexOf(item);
               currentOffset = -clickedIndex * 40;
               
               numberList.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
               updatePosition(currentOffset);
           }
       });
       
       // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
       updatePosition(currentOffset);
   }

   function generateLuckyNumbers() {
       const pickers = document.querySelectorAll('.number-picker');
       const newNumbers = [];
       
       pickers.forEach((picker, index) => {
           const randomNum = Math.floor(Math.random() * 10);
           const randomOffset = -(randomNum * 40 + 200); // +200 –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
           
           const numberList = picker.querySelector('.number-list');
           numberList.style.transition = 'transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
           numberList.style.transform = `translateY(${randomOffset}px)`;
           
           // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
           setTimeout(() => {
               const activeIndex = Math.round(-randomOffset / 40);
               const items = numberList.querySelectorAll('.number-item');
               
               items.forEach((item, i) => {
                   item.classList.toggle('active', i === activeIndex);
               });
               
               selectedNumbers[index] = randomNum;
               newNumbers[index] = randomNum;
           }, 100);
       });
       
       // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å–ª–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±–∏–ª–µ—Ç–∞
       setTimeout(() => {
           tickets[currentTicketIndex].numbers = [...newNumbers];
       }, 200);
   }

   function displayPrizes() {
       const prizesList = document.getElementById('prizesList');
       prizesList.innerHTML = '';
       
       if (window.currentDrawData.prizes && window.currentDrawData.prizes.length > 0) {
           window.currentDrawData.prizes.forEach(prize => {
               const prizeItem = document.createElement('div');
               prizeItem.className = 'prize-item';
               
               prizeItem.innerHTML = `
                   <h3 class="prize-name">${prize.name}</h3>
                   <p class="prize-chance">${getChanceText(prize)}</p>
               `;
               
               prizesList.appendChild(prizeItem);
           });
       }
   }

   function getChanceText(prize) {
       const ticketsCount = tickets.length;
       if (window.currentDrawData.category === 'big' && apartmentTicketsCount >= prize.min_tickets) {
           return `${Math.floor(apartmentTicketsCount / prize.chance_per)} —à–∞–Ω—Å`;
       }
       return `${Math.floor(ticketsCount / prize.chance_per)} —à–∞–Ω—Å`;
   }

   function addTicket() {
       if (isAnimating || tickets.length >= 10) return;
       
       // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —á–∏—Å–ª–∞
       saveCurrentTicketNumbers();
       
       isAnimating = true;
       
       // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –±–∏–ª–µ—Ç
       const newTicket = {
           id: tickets.length + 1,
           numbers: []
       };
       tickets.push(newTicket);
       currentTicketIndex = tickets.length - 1;
       
       // –ê–Ω–∏–º–∞—Ü–∏—è —É—Ö–æ–¥—è—â–µ–≥–æ –±–∏–ª–µ—Ç–∞
       const currentTicket = document.getElementById('currentTicket');
       currentTicket.classList.add('slide-out');
       
       // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –±–∏–ª–µ—Ç
       setTimeout(() => {
           currentTicket.classList.remove('slide-out');
           currentTicket.classList.add('slide-in');
           
           // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ —Å–ª—É—á–∞–π–Ω—ã–µ —á–∏—Å–ª–∞
           generateLuckyNumbers();
           
           setTimeout(() => {
               currentTicket.classList.remove('slide-in');
               isAnimating = false;
           }, 100);
           
           // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
           updateInterface();
       }, 250);
   }

   function previousTicket() {
       if (isAnimating || currentTicketIndex <= 0) return;
       
       saveCurrentTicketNumbers();
       isAnimating = true;
       currentTicketIndex--;
       
       const currentTicket = document.getElementById('currentTicket');
       currentTicket.classList.add('slide-out');
       
       setTimeout(() => {
           currentTicket.classList.remove('slide-out');
           currentTicket.classList.add('slide-in');
           
           // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∏—Å–ª–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –±–∏–ª–µ—Ç–∞
           loadTicketNumbers(currentTicketIndex);
           
           setTimeout(() => {
               currentTicket.classList.remove('slide-in');
               isAnimating = false;
           }, 100);
           
           updateInterface();
       }, 250);
   }

   function nextTicket() {
       if (isAnimating || currentTicketIndex >= tickets.length - 1) return;
       
       saveCurrentTicketNumbers();
       isAnimating = true;
       currentTicketIndex++;
       
       const currentTicket = document.getElementById('currentTicket');
       currentTicket.classList.add('slide-out');
       
       setTimeout(() => {
           currentTicket.classList.remove('slide-out');
           currentTicket.classList.add('slide-in');
           
           // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∏—Å–ª–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–∏–ª–µ—Ç–∞
           loadTicketNumbers(currentTicketIndex);
           
           setTimeout(() => {
               currentTicket.classList.remove('slide-in');
               isAnimating = false;
           }, 100);
           
           updateInterface();
       }, 250);
   }

   function deleteCurrentTicket() {
       if (isAnimating || tickets.length <= 1) {
           // –ù–µ –ø–æ–∑–≤–æ–ª—è–µ–º —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∏–ª–µ—Ç
           shakeElement(document.getElementById('currentTicket'));
           return;
       }
       
       isAnimating = true;
       
       // –£–¥–∞–ª—è–µ–º –±–∏–ª–µ—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞
       tickets.splice(currentTicketIndex, 1);
       
       // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –∏–Ω–¥–µ–∫—Å
       if (currentTicketIndex >= tickets.length) {
           currentTicketIndex = tickets.length - 1;
       }
       
       // –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ–º ID –±–∏–ª–µ—Ç–æ–≤
       tickets.forEach((ticket, index) => {
           ticket.id = index + 1;
       });
       
       // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è
       const currentTicket = document.getElementById('currentTicket');
       currentTicket.style.transform = 'scale(0.8) rotateZ(10deg)';
       currentTicket.style.opacity = '0';
       
       setTimeout(() => {
           currentTicket.style.transform = '';
           currentTicket.style.opacity = '';
           
           // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∏—Å–ª–∞ —Ç–µ–∫—É—â–µ–≥–æ –±–∏–ª–µ—Ç–∞
           loadTicketNumbers(currentTicketIndex);
           
           isAnimating = false;
           updateInterface();
       }, 300);
   }

   function saveCurrentTicketNumbers() {
       // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —á–∏—Å–ª–∞ –≤ –±–∏–ª–µ—Ç–µ
       if (tickets[currentTicketIndex]) {
           tickets[currentTicketIndex].numbers = [...selectedNumbers];
       }
   }

   function loadTicketNumbers(ticketIndex) {
       const ticket = tickets[ticketIndex];
       if (!ticket || !ticket.numbers.length) {
           generateLuckyNumbers();
           return;
       }
       
       // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–∏—Å–ª–∞ –≤ —Å–ª–∞–π–¥–µ—Ä—ã
       const pickers = document.querySelectorAll('.number-picker');
       
       pickers.forEach((picker, index) => {
           const targetNumber = ticket.numbers[index] || 0;
           const targetOffset = -(targetNumber * 40 + 200);
           
           const numberList = picker.querySelector('.number-list');
           numberList.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
           numberList.style.transform = `translateY(${targetOffset}px)`;
           
           // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
           setTimeout(() => {
               const activeIndex = Math.round(-targetOffset / 40);
               const items = numberList.querySelectorAll('.number-item');
               
               items.forEach((item, i) => {
                   item.classList.toggle('active', i === activeIndex);
               });
               
               selectedNumbers[index] = targetNumber;
           }, 50);
       });
   }

   function updateInterface() {
       const ticketsCount = tickets.length;
       
       // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –±–∏–ª–µ—Ç–∞
       document.getElementById('ticketTitle').textContent = `–ë–∏–ª–µ—Ç #${tickets[currentTicketIndex].id}`;
       
       // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –±–∏–ª–µ—Ç–æ–≤
       document.getElementById('ticketCounter').textContent = `${currentTicketIndex + 1} –∏–∑ ${ticketsCount}`;
       
       // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
       const navLeft = document.getElementById('navLeft');
       const navRight = document.getElementById('navRight');
       
       navLeft.disabled = currentTicketIndex <= 0;
       navRight.disabled = currentTicketIndex >= ticketsCount - 1;
       
       // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏
       const purchaseText = document.getElementById('purchaseText');
       const totalPrice = document.getElementById('totalPrice');
       const ticketPrice = window.currentDrawData.cost;
       
       if (ticketsCount === 1) {
           purchaseText.textContent = '–ö—É–ø–∏—Ç—å 1 –±–∏–ª–µ—Ç';
       } else {
           purchaseText.textContent = `–ö—É–ø–∏—Ç—å ${ticketsCount} –±–∏–ª–µ—Ç–æ–≤`;
       }
       
       totalPrice.textContent = ticketPrice * ticketsCount;
       
       // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞
       updateTicketsProgress();
       
       // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥–ª—è big —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π
       if (window.currentDrawData.category === 'big') {
           updateApartmentProgress();
       }
       
       // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏–∑—ã
       displayPrizes();
       
       // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–∞
       const addButton = document.getElementById('addButton');
       if (ticketsCount >= 10) {
           addButton.style.display = 'none';
       } else {
           addButton.style.display = 'flex';
       }
   }

   function updateTicketsProgress() {
       const ticketsInfo = document.getElementById('ticketsInfo');
       const ticketsFill = document.getElementById('ticketsFill');
       const cycle = window.currentDrawData.bonus_tickets_cycle;
       const ticketsCount = tickets.length;
       
       const remaining = cycle - (ticketsCount % cycle);
       const progress = (ticketsCount % cycle) / cycle * 100;
       
       if (remaining === cycle) {
           ticketsInfo.textContent = `–ï—â–µ ${remaining} –±–∏–ª–µ—Ç–æ–≤ –∏ 1 –±–∏–ª–µ—Ç –ø–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ`;
       } else if (remaining === 1) {
           ticketsInfo.textContent = `–ï—â–µ ${remaining} –±–∏–ª–µ—Ç –∏ 1 –±–∏–ª–µ—Ç –ø–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ`;
       } else {
           ticketsInfo.textContent = `–ï—â–µ ${remaining} –±–∏–ª–µ—Ç–∞ –∏ 1 –±–∏–ª–µ—Ç –ø–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ`;
       }
       
       ticketsFill.style.width = `${progress}%`;
   }

   function updateApartmentProgress() {
       const progressFill = document.getElementById('progressFill');
       const progressText = document.getElementById('progressText');
       const contestStatus = document.getElementById('contestStatus');
       const apartmentContest = document.getElementById('apartmentContest');
       const ticketsCount = tickets.length;
       
       // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤ –∫–∞–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–∞—Ä—Ç–∏—Ä—ã
       apartmentTicketsCount = Math.min(ticketsCount, 5);
       const progress = (apartmentTicketsCount / 5) * 100;
       
       progressFill.style.width = `${progress}%`;
       progressText.textContent = `${apartmentTicketsCount} –∏–∑ 5`;
       
       if (apartmentTicketsCount >= 5) {
           contestStatus.textContent = '–£—á–∞—Å—Ç–≤—É—é';
           apartmentContest.classList.add('active');
       } else {
           contestStatus.textContent = '–£—á–∞—Å—Ç–≤—É—é';
           apartmentContest.classList.remove('active');
       }
   }

   function purchaseTickets() {
       const purchaseSection = document.getElementById('purchaseSection');
       purchaseSection.classList.add('loading');
       
       // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
       setTimeout(() => {
           purchaseSection.classList.remove('loading');
           showSuccessModal();
       }, 1500);
   }

   function showSuccessModal() {
       const modal = document.getElementById('successModal');
       const modalText = document.getElementById('modalText');
       const ticketsCount = tickets.length;
       const totalCost = window.currentDrawData.cost * ticketsCount;
       
       let ticketsWord;
       if (ticketsCount === 1) {
           ticketsWord = '–±–∏–ª–µ—Ç';
       } else if (ticketsCount < 5) {
           ticketsWord = '–±–∏–ª–µ—Ç–∞';
       } else {
           ticketsWord = '–±–∏–ª–µ—Ç–æ–≤';
       }
       
       modalText.innerHTML = `
           –í—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª–∏ ${ticketsCount} ${ticketsWord}<br>
           –Ω–∞ —Å—É–º–º—É ${totalCost} ü™ô
       `;
       
       modal.classList.add('show');
   }

   function closeModal() {
       const modal = document.getElementById('successModal');
       modal.classList.remove('show');
   }

   function goBack() {
       // –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
       window.location.href = '/';
   }

   function closeTicketPurchase() {
       // –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–∫—É–ø–∫–∏
       if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–∞? –ù–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
           window.location.href = '/';
       }
   }

   function goToTickets() {
       closeModal();
       // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ú–æ–∏ –±–∏–ª–µ—Ç—ã"
       window.location.href = '/tickets';
   }

   function goToMain() {
       closeModal();
       // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
       window.location.href = '/';
   }

   // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
   document.getElementById('successModal').addEventListener('click', function(e) {
       if (e.target === this) {
           closeModal();
       }
   });

   // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
   document.addEventListener('keydown', function(e) {
       if (isAnimating) return;
       
       switch(e.key) {
           case 'ArrowLeft':
               e.preventDefault();
               previousTicket();
               break;
           case 'ArrowRight':
               e.preventDefault();
               nextTicket();
               break;
           case 'Delete':
           case 'Backspace':
               if (e.ctrlKey || e.metaKey) {
                   e.preventDefault();
                   deleteCurrentTicket();
               }
               break;
           case 'Enter':
               if (e.ctrlKey || e.metaKey) {
                   e.preventDefault();
                   addTicket();
               }
               break;
           case ' ':
               e.preventDefault();
               generateLuckyNumbers();
               break;
       }
   });

   // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ —Å–ª–∞–π–¥–µ—Ä–∞–º–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
   document.addEventListener('touchmove', function(e) {
       const picker = e.target.closest('.number-picker');
       if (picker) {
           e.preventDefault();
       }
   }, { passive: false });

   // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Ç—Ä—è—Å–∫–∏ –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
   function shakeElement(element) {
       element.style.animation = 'shake 0.5s ease-in-out';
       setTimeout(() => {
           element.style.animation = '';
       }, 500);
   }

   // CSS –∞–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏
   const shakeKeyframes = `
       @keyframes shake {
           0%, 100% { transform: translateX(0); }
           25% { transform: translateX(-5px); }
           75% { transform: translateX(5px); }
       }
   `;
   
   const style = document.createElement('style');
   style.textContent = shakeKeyframes;
   document.head.appendChild(style);
</script>
</body>
</html>